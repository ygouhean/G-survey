# Capture Directe Photo et VidÃ©o ğŸ“·ğŸ¥

## ğŸ¯ FonctionnalitÃ©

Les questions de type Photo et VidÃ©o permettent maintenant une **capture directe** via la camÃ©ra de n'importe quel appareil (ordinateur, tablette, tÃ©lÃ©phone) en utilisant l'API WebRTC.

---

## âœ¨ Nouvelles CapacitÃ©s

### ğŸ“· Capture Photo

#### Deux Options
1. **ğŸ“¸ Ouvrir la camÃ©ra** : Capture directe via WebRTC
2. **ğŸ“ Choisir un fichier** : Upload classique depuis la galerie

#### FonctionnalitÃ©s
- âœ… AccÃ¨s camÃ©ra en temps rÃ©el (tous appareils)
- âœ… PrÃ©visualisation live du flux vidÃ©o
- âœ… Changement de camÃ©ra (avant/arriÃ¨re)
- âœ… Capture haute qualitÃ© (1920x1080)
- âœ… Validation de taille automatique
- âœ… Support photos multiples
- âœ… Suppression individuelle des photos
- âœ… Interface plein Ã©cran optimisÃ©e

### ğŸ¥ Capture VidÃ©o

#### Deux Options
1. **ğŸ¬ Enregistrer une vidÃ©o** : Enregistrement direct via WebRTC
2. **ğŸ“ Choisir un fichier** : Upload depuis l'appareil

#### FonctionnalitÃ©s
- âœ… Enregistrement vidÃ©o en temps rÃ©el (tous appareils)
- âœ… Enregistrement audio inclus
- âœ… Changement de camÃ©ra (avant/arriÃ¨re)
- âœ… Timer d'enregistrement visible
- âœ… Indicateur d'enregistrement (point rouge)
- âœ… Validation de taille automatique
- âœ… Support vidÃ©os multiples
- âœ… Suppression individuelle des vidÃ©os
- âœ… Format WebM optimisÃ©

---

## ğŸ–¥ï¸ Interface Utilisateur

### Capture Photo - Ã‰cran Plein

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ•   Prendre une photo        ğŸ”„    â”‚ â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚                                     â”‚
â”‚         [Flux vidÃ©o live]           â”‚ â† PrÃ©visualisation
â”‚                                     â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â—‰                      â”‚ â† Bouton capture
â”‚   Appuyez pour capturer             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Capture VidÃ©o - Ã‰cran Plein

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ•  Enregistrer une vidÃ©o     ğŸ”„    â”‚
â”‚     â— 00:15 (enregistrement)        â”‚ â† Timer
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚                                     â”‚
â”‚         [Flux vidÃ©o live]           â”‚ â† PrÃ©visualisation
â”‚                                     â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â–                       â”‚ â† Bouton stop
â”‚   Appuyez pour arrÃªter              â”‚
â”‚   Taille max : 10 MB                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dans le Formulaire

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ“·                           â”‚
â”‚  [ğŸ“¸ Ouvrir la camÃ©ra]              â”‚
â”‚  [ğŸ“ Choisir un fichier]            â”‚
â”‚                                      â”‚
â”‚  Taille max: 10 MB                   â”‚
â”‚  (plusieurs photos autorisÃ©es)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Photos sÃ©lectionnÃ©es (3) :
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚ IMG â”‚ â”‚ IMG â”‚ â”‚ IMG â”‚
â”‚  âœ•  â”‚ â”‚  âœ•  â”‚ â”‚  âœ•  â”‚ â† Boutons suppression
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Composants CrÃ©Ã©s

### 1. `CameraCapture.tsx`

**Props** :
- `onCapture: (file: File) => void` - Callback avec la photo capturÃ©e
- `onClose: () => void` - Callback fermeture
- `maxSizeMB?: number` - Taille max en MB (dÃ©faut: 10)

**FonctionnalitÃ©s** :
- AccÃ¨s Ã  `navigator.mediaDevices.getUserMedia()`
- PrÃ©visualisation avec `<video>` element
- Capture sur `<canvas>` hidden
- Conversion en File JPEG (qualitÃ© 90%)
- Validation de taille
- Changement de camÃ©ra (facingMode)
- ArrÃªt propre du stream

**Ã‰tats** :
```typescript
- stream: MediaStream | null
- error: string
- facingMode: 'user' | 'environment'
```

### 2. `VideoCapture.tsx`

**Props** :
- `onCapture: (file: File) => void` - Callback avec la vidÃ©o
- `onClose: () => void` - Callback fermeture
- `maxSizeMB?: number` - Taille max en MB (dÃ©faut: 10)

**FonctionnalitÃ©s** :
- Enregistrement avec `MediaRecorder` API
- Support audio + vidÃ©o
- Timer d'enregistrement
- Indicateur visuel (point rouge clignotant)
- Format WebM (vp9 ou fallback)
- Validation de taille
- Changement de camÃ©ra
- ArrÃªt propre du stream et recorder

**Ã‰tats** :
```typescript
- stream: MediaStream | null
- isRecording: boolean
- recordingTime: number
- error: string
- facingMode: 'user' | 'environment'
```

---

## ğŸ“± Support Appareils

### Ordinateur (Desktop)
- âœ… AccÃ¨s webcam intÃ©grÃ©e
- âœ… Webcam externe USB
- âœ… Changement de camÃ©ra si plusieurs
- âœ… Micro pour vidÃ©os
- âœ… Chrome, Firefox, Edge, Safari

### Tablette
- âœ… CamÃ©ra avant
- âœ… CamÃ©ra arriÃ¨re
- âœ… Changement automatique
- âœ… Tactile optimisÃ©
- âœ… iOS Safari, Android Chrome

### TÃ©lÃ©phone
- âœ… CamÃ©ra avant (selfie)
- âœ… CamÃ©ra arriÃ¨re (principale)
- âœ… Bouton de changement
- âœ… Mode portrait/paysage
- âœ… iOS Safari, Android Chrome

---

## ğŸ” Permissions

### Demande de Permission
Au premier accÃ¨s, le navigateur demande :
- **Photo** : Permission camÃ©ra
- **VidÃ©o** : Permission camÃ©ra + microphone

### Gestion des Erreurs
```typescript
try {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: 'environment' },
    audio: true  // Pour vidÃ©o uniquement
  })
} catch (err) {
  // Affiche : "Impossible d'accÃ©der Ã  la camÃ©ra"
  // + Instructions pour activer les permissions
}
```

### Messages d'Erreur
- âŒ "Impossible d'accÃ©der Ã  la camÃ©ra. VÃ©rifiez les permissions."
- âŒ "La photo est trop volumineuse (15.2 MB). Taille max : 10 MB"
- âŒ "La vidÃ©o est trop volumineuse (25.8 MB). Taille max : 10 MB"

---

## âš™ï¸ Configuration Technique

### QualitÃ© Photo
```typescript
video: {
  facingMode: 'environment',  // ou 'user' pour selfie
  width: { ideal: 1920 },
  height: { ideal: 1080 }
}

canvas.toBlob(blob => {
  // Conversion JPEG
}, 'image/jpeg', 0.9)  // QualitÃ© 90%
```

### QualitÃ© VidÃ©o
```typescript
video: {
  facingMode: 'environment',
  width: { ideal: 1920 },
  height: { ideal: 1080 }
},
audio: true

// Format WebM avec codec VP9
mimeType: 'video/webm;codecs=vp9'
// Fallback: 'video/webm'
```

### Optimisations
- Photos en JPEG (meilleure compression)
- QualitÃ© 90% (bon rapport qualitÃ©/taille)
- VidÃ©os en WebM (format moderne, bonne compression)
- ArrÃªt automatique des streams (Ã©conomie batterie)

---

## ğŸ¨ AmÃ©liorations UX

### Interface Photo
- âœ… Design plein Ã©cran immersif
- âœ… Gradients semi-transparents
- âœ… Gros bouton de capture intuitif
- âœ… Bouton fermeture toujours visible
- âœ… Changement de camÃ©ra en un clic
- âœ… Messages d'erreur clairs

### Interface VidÃ©o
- âœ… Timer en temps rÃ©el
- âœ… Point rouge pulsant (enregistrement)
- âœ… Bouton Start (â—) / Stop (â– )
- âœ… DÃ©sactivation changement camÃ©ra pendant enregistrement
- âœ… Indication taille max
- âœ… Fermeture sÃ©curisÃ©e (arrÃªt enregistrement)

### Galerie Photos/VidÃ©os
- âœ… Compteur d'Ã©lÃ©ments
- âœ… PrÃ©visualisation miniatures (photos)
- âœ… Liste dÃ©taillÃ©e (vidÃ©os avec taille)
- âœ… Bouton suppression par Ã©lÃ©ment
- âœ… Effet hover sur suppression

---

## ğŸ’¡ Cas d'Usage

### EnquÃªte de Terrain
```
Question : Photographier le lieu d'intervention
- Type : Photo
- Multiple : Oui
- Max : 20 MB
â†’ L'agent ouvre la camÃ©ra et prend 5 photos du site
```

### TÃ©moignage Client
```
Question : Enregistrez votre avis en vidÃ©o
- Type : VidÃ©o
- Multiple : Non
- Max : 50 MB
â†’ Le client enregistre un tÃ©moignage de 30 secondes
```

### ContrÃ´le QualitÃ©
```
Question : Photos du produit dÃ©fectueux
- Type : Photo
- Multiple : Oui
- Max : 10 MB
â†’ 3 photos sous diffÃ©rents angles
```

### Incident
```
Question : VidÃ©o de l'incident
- Type : VidÃ©o
- Multiple : Non
- Max : 100 MB
â†’ Enregistrement de 1 minute
```

---

## ğŸš€ Utilisation

### CrÃ©er une Question Photo
1. CrÃ©er un sondage
2. Ajouter question **ğŸ“· Prendre une photo**
3. Configurer :
   - Taille max : 10-50 MB
   - Multiple : Oui/Non
4. Tester la capture

### CrÃ©er une Question VidÃ©o
1. CrÃ©er un sondage
2. Ajouter question **ğŸ¥ Prendre une vidÃ©o**
3. Configurer :
   - Taille max : 20-100 MB (vidÃ©os plus volumineuses)
   - Multiple : Oui/Non
4. Tester l'enregistrement

### RÃ©pondre au Sondage
**Option 1 : Capture directe**
1. Cliquer "Ouvrir la camÃ©ra" ou "Enregistrer une vidÃ©o"
2. Autoriser les permissions si demandÃ©
3. Capturer/Enregistrer
4. Valider ou recommencer

**Option 2 : Upload fichier**
1. Cliquer "Choisir un fichier"
2. SÃ©lectionner depuis la galerie
3. Confirmer

---

## âš ï¸ Limitations & ConsidÃ©rations

### Taille des Fichiers
- **Photos** : 1-5 MB typique (haute qualitÃ©)
- **VidÃ©os** : 5-10 MB par minute (WebM)
- **Recommandation** : 10-20 MB pour photos, 50-100 MB pour vidÃ©os

### Support Navigateurs
| Navigateur | Desktop | Mobile | Notes |
|-----------|---------|--------|-------|
| Chrome | âœ… | âœ… | Support complet |
| Firefox | âœ… | âœ… | Support complet |
| Safari | âœ… | âœ… | iOS 11+ requis |
| Edge | âœ… | âœ… | Support complet |
| Opera | âœ… | âœ… | Support complet |

### Stockage
âš ï¸ **Important** : Les fichiers sont en mÃ©moire cÃ´tÃ© client.

Pour la production, implÃ©menter :
- Upload vers serveur backend
- Service de stockage cloud (AWS S3, Firebase, etc.)
- Compression cÃ´tÃ© serveur si nÃ©cessaire
- Base de donnÃ©es pour mÃ©tadonnÃ©es

### SÃ©curitÃ©
- âœ… Permissions utilisateur requises
- âœ… HTTPS requis pour getUserMedia
- âœ… Validation de taille cÃ´tÃ© client
- âš ï¸ Validation serveur nÃ©cessaire en production

---

## ğŸ“Š Fichiers CrÃ©Ã©s/ModifiÃ©s

### Nouveaux Composants
- `src/components/CameraCapture.tsx` - Composant capture photo
- `src/components/VideoCapture.tsx` - Composant enregistrement vidÃ©o

### Fichiers ModifiÃ©s
- `src/pages/surveys/SurveyRespond.tsx` :
  - Import des composants
  - Ã‰tats de gestion des modals
  - Boutons d'ouverture
  - Rendu conditionnel des modals
  - Gestion photos/vidÃ©os multiples
  - Suppression individuelle

### Documentation
- `CAPTURE_CAMERA_VIDEO.md` - Ce fichier

---

## ğŸ“ DiffÃ©rences Avant/AprÃ¨s

### Avant
```
[ğŸ“¸ Prendre une photo]
     â†“
Ouvre sÃ©lecteur de fichiers
     â†“
Sur mobile : Option camÃ©ra OU galerie
Sur desktop : Seulement fichiers
```

### AprÃ¨s
```
[ğŸ“¸ Ouvrir la camÃ©ra]  [ğŸ“ Choisir un fichier]
         â†“                        â†“
   Capture directe          Upload fichier
   (tous appareils)        (comme avant)
         â†“
   Interface plein Ã©cran
   PrÃ©visualisation live
   Changement camÃ©ra
         â†“
   Photo/VidÃ©o capturÃ©e
```

---

## âœ… Avantages

### Pour les Utilisateurs
- âœ… Capture instantanÃ©e sans quitter l'application
- âœ… Interface intuitive et moderne
- âœ… PrÃ©visualisation avant capture
- âœ… Changement facile de camÃ©ra
- âœ… Feedback visuel immÃ©diat

### Pour les EnquÃªtes
- âœ… Meilleur taux de complÃ©tion
- âœ… Photos/vidÃ©os de meilleure qualitÃ©
- âœ… ExpÃ©rience utilisateur fluide
- âœ… Moins d'abandon (workflow simplifiÃ©)
- âœ… DonnÃ©es plus riches

### Technique
- âœ… API standard (WebRTC)
- âœ… Support multi-plateforme
- âœ… Pas de dÃ©pendances externes
- âœ… Performance optimisÃ©e
- âœ… Gestion mÃ©moire propre

---

## ğŸ‰ RÃ©sumÃ©

Les questions Photo et VidÃ©o utilisent maintenant **l'API WebRTC** pour permettre une **capture directe** sur **tous les appareils** :

- ğŸ“· **Capture photo instantanÃ©e** avec prÃ©visualisation live
- ğŸ¥ **Enregistrement vidÃ©o** avec audio et timer
- ğŸ”„ **Changement de camÃ©ra** (avant/arriÃ¨re)
- ğŸ“± **Support universel** (PC, tablette, tÃ©lÃ©phone)
- ğŸ¨ **Interface immersive** plein Ã©cran
- âœ… **Validation automatique** de la taille
- ğŸ—‘ï¸ **Gestion individuelle** des fichiers

Le systÃ¨me G-survey offre maintenant une expÃ©rience de capture multimÃ©dia **professionnelle** et **intuitive** ! ğŸš€



